# AI Guardrails — Trutta Hub

Цей документ визначає, що **AI-агенти** (Codex, repo-ingestion-agent, doc-canonisation-agent та інші) мають право робити в репозиторії `Trutta Hub`, а що — ні.

Мета:
- захистити canonical-документи від випадкових правок;
- зробити поведінку агентів передбачуваною;
- дозволити автоматизацію інгесту, канонізації та оновлення статусів.

---

## 1. Базові принципи

1. Агенти працюють **поверх гіта**:
   - будь-які зміни мають бути прозорі й diff-овані.
2. Агенти **не вигадують факти**:
   - можна структурувати, стискати, узгоджувати формулювання;
   - не можна додумувати бізнес-умови, юридичні вимоги, метрики.
3. Canonical > candidates:
   - у конфлікті між існуючим canonical-документом і новим кандидатом
     агент не затирає canonical, а фіксує конфлікт у статусах.

---

## 2. Ролі директорій (для агентів)

### 2.1. Директорії, які **заборонено змінювати** без явного завдання

- `docs/` — canonical PD/VG/guides/policies.
- `concepts/` — формалізовані концепти (TJM, ABC, токени).
- `domains/` — доменні моделі.
- `schemas/` — схеми даних та подій.
- `templates/` — темплейти проєктів/архітектур/дизайну.
- `agents/` — описи агентів і систем.
- `infra/` — інфраструктурні конфіги.
- `monitoring/` — метрики/алерти.
- `config/` — контракти конфігів.
- `tests/` — тести.

Будь-яка зміна тут допускається тільки:
- або через спеціальний агент (типу `doc-canonisation-agent`);
- або за явною інструкцією від людини.

### 2.2. Директорії, де **агенти можуть писати**

- `ingestion/`:
  - `ingestion-index.yaml`
  - `logs/`
  - використання трансформацій.
- `import/`:
  - тільки читання (сюди пишуть люди/зовнішні процеси).
- `progress/`:
  - індекси/статуси (`artefact-index.yaml`, `*-status.yaml`, workflow-статуси) — оновлюються спеціалізованими агентами.
- `*.clean.md`, `*.summary.md`:
  - можуть створюватись поруч з оригінальними документами (постфільтрація/стиснення).

---

## 3. Типи агентів і їхні обмеження

### 3.1. `repo-ingestion-agent`

Має право:
- читати **весь** репозиторій (крім технічних директорій типу `.git`, `node_modules`, `dist`);
- писати:
  - `ingestion/ingestion-index.yaml`;
  - файли у `ingestion/logs/`;
  - `*.clean.md`, `*.summary.md` поруч з `doc/marketing` файлами.

Не має права:
- змінювати `docs/`, `concepts/`, `domains/`, `schemas/`, `templates/`,
  `agents/`, `infra/`, `progress/`, `monitoring/`.

### 3.2. `doc-canonisation-agent`

Має право:
- читати:
  - `ingestion/ingestion-index.yaml`,
  - canonical-документи (`docs/`, `concepts/`, `domains/`, `templates/`),
  - `progress/artefacts/*`.
- писати:
  - нові/оновлені canonical-файли (по чітких шаблонах),
  - `progress/artefacts/artefact-index.yaml`,
  - `progress/artefacts/docs-status.yaml`.

Обмеження:
- не змінює `ingestion/`, `infra/`, `tools/`, `monitoring/`;
- не видаляє існуючих canonical-файлів;
- у разі конфлікту версій:
  - ставить `status=conflict` у статусах,
  - додає коротку примітку, але не перетирає текст.

### 3.3. Інші агенти (data-raids, data-conveyors, macro-teams)

- мають власні guardrails у своїх `*.agent.yaml` та `*.system.yaml`;
- за замовчуванням:
  - читають домени/схеми;
  - пишуть у `progress/`, `monitoring/`, тимчасові `*.clean.*`/`*.report.*` файли.

---

## 4. Робота з PII / health / FDA

Агенти **не** мають права:

- зберігати PII (імʼя, e-mail, телефон, точну геолокацію користувача) в репозиторії;
- генерувати або зберігати індивідуальні медичні рекомендації.

Дозволено:
- працювати з **агрегованими або анонімізованими** даними;
- використовувати FDA/health-документи як:
  - словники нутрієнтів,
  - constraint-моделі (типу «цей інгредієнт — заборонений для такого профілю»),
  але не як підставу для діагностики.

---

## 5. Правила модифікації тексту

Агенти можуть:

- **стиснювати** текст (summary, `.clean.md`);
- **нормалізувати** структуру (розбивка на секції, списки);
- **прибирати воду** з маркетингових текстів;
- **уніфікувати термінологію** до глосарію (`PD-002-concepts-and-glossary.md`).

Агенти не можуть:

- змінювати сенс бізнес-правил;
- змінювати юридичні тексти без явного таску (`Legal review`);
- змінювати фінансові формули/юніт-економіку без участі людини.

---

## 6. Конфлікти й ескалація

Якщо агент бачить:

- суперечливі артефакти (два різних PD для того самого продукту),
- кардинально різні схеми для одного домену,
- неможливість обʼєднати зміни без втрати сенсу —

він повинен:

1. Не робити автоматичного merge.
2. Позначити артефакт як `status=conflict` у `docs-status.yaml`.
3. Додати короткий опис конфлікту (які файли, які розбіжності).
4. Нічого не видаляти.

Розрулювання конфліктів — задача людей (product/arch/data/legal).

---

## 7. Логування

Кожен агент, який модифікує файли, має:

- залишати лог у своїй зоні (наприклад, `ingestion/logs/`, `progress/...`, `monitoring/events-log/`);
- фіксувати:
  - час прогону,
  - кількість змінених/створених файлів,
  - типи рішень (наприклад, скільки `promote_candidate`),
  - нетипові ситуації.

Якщо щось пішло не так — пріоритет: **зупинитись раніше**, ніж зіпсувати canonical.
