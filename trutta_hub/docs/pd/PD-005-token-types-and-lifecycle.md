# PD-005 — Trutta Token Types & Lifecycle

**ID:** PD-005  
**Назва:** Trutta Token Types & Lifecycle  
**Статус:** draft  
**Власники:** arch, product, tokenomics, legal  
**Повʼязані документи:**  
- PD-001 — Trutta Product DSL Blueprint  
- PD-002 — Trutta Concepts & Glossary  
- PD-003 — Trutta DSL File Types & Schemas  
- PD-004 — Industrial Data & Knowledge Layers  
- CONCEPT-* — окремі концепти токенів (TJM, ABC, Sospeso, тощо)  
- VG-8xx — Engineering: Token Runtime  
- VG-9xx — Analytics & Token Metrics

---

## 1. Purpose

Цей документ:

- задає **таксономію типів токенів** у Trutta;
- визначає **універсальний життєвий цикл (state machine)**;
- фіксує **обмеження безпеки/антифроду** на рівні дизайну;
- описує, як токени вбудовуються в:
  - Product DSL,
  - TJM (travel journey),
  - ABC (анонімні спільноти),
  - індустріальні домени (tourism, services, food, health).

Мета — мати стабільний каркас, який витримає:

- різні ринки/юрисдикції;
- on-chain/off-chain імплементації;
- нові продуктові сценарії, не ламаючи базову модель.

---

## 2. Scope

### 2.1. Входить

- логічні **класи токенів** (archetypes);
- універсальний **state machine**;
- загальні **правила використання** (constraints, fraud-мислення);
- звʼязок із DSL (`*.token.yaml`, `offer.yaml`, `constraints.yaml`).

### 2.2. Не входить

- конкретні блокчейн-примітиви (SPL/Token-2022/OFT/інше);
- детальна фінансова/податкова модель;
- конкретні умови емісії для окремих проєктів (Sospeso, BREAD, тощо) — це окремі PD/VG.

---

## 3. Design principles

1. **Entitlement-first**  
   Токен = формалізоване право (entitlement), а не «монета заради монети».

2. **Minimal leakage**  
   Цінність токена максимально привʼязана до сервісу/досвіду, а не до спекуляції.

3. **Composable, але обмежений ризик**  
   Токени можна компонувати (bundles, passes), але з жорсткими guardrails по фроду й регуляторці.

4. **Chain-agnostic**  
   Логіка типів і станів не завʼязана на конкретний блокчейн.

5. **Privacy-aware**  
   Особливо для health/kidney-friendly кейсів: токени не розкривають PII, працюють із абстрактними профілями/constraints.

---

## 4. Token taxonomy (archetypes)

### 4.1. Base Entitlement Token

**Призначення:** базове право «одна дія / одна одиниця сервісу».

Приклади:

- одна чашка кави в participating-вендорів;
- один прийом їжі;
- одна ніч проживання (стандартний номер);
- один вхід у локацію/подію.

Характеристики:

- простий lifecycle: `issued → claimed → redeemed/expired`;
- чітка привʼязка до:
  - `Product/Offer`,
  - `ServicePoint/Hotel`,
  - `Constraints` (time/geo/health).

### 4.2. Bundle / Package Token

**Призначення:** право на **набір** базових entitlements.

Приклади:

- «3 ночі + 3 сніданки»;
- «5 кав упродовж тижня»;
- «City pass на N поїздок/входів».

Характеристики:

- агрегує кілька `TokenType` під одним ID;
- може:
  - розкладатися на суб-токени (на рівні runtime),
  - або вести лічильник «залишилось X з N».

### 4.3. Pass / Access Token

**Призначення:** право на **період або режим доступу**, а не на конкретну кількість.

Приклади:

- day-pass на міський транспорт;
- weekend-pass на каву в партнерських точках;
- city-experience pass.

Характеристики:

- сильний time/geo constraint;
- lifecycle: `issued → activated (first use) → active → expired`.

### 4.4. Payment / Stable-like Token (internal use)

**Призначення:** внутрішній розрахунковий/обліковий токен між:

- Trutta ↔ вендори;
- суб-агенти ↔ Trutta.

**Не є інвестиційним інструментом** — дизайн із мінімізацією ризику регуляторних тригерів.

Характеристики:

- привʼязка до стейбл-валют (в ідеалі 1:1 до off-chain балансу);
- використовується в settlement-контурах, а не як primary UX для кінцевого юзера.

### 4.5. Utility / Service Token

**Призначення:** доступ до певних функцій екосистеми:

- advanced features;
- додаткові data-ансамблі;
- white-label сервіси.

Має бути чітко відділений від entitlement-токенів (meal/night/pass).

### 4.6. Status / Reputation (Soulbound-like)

**Призначення:** несуть **статус/репутацію/роль**, не гроші.

Приклади:

- амбасадор/контрибʼютор;
- вендор із певним рівнем довіри/SLА;
- статус медичного партнера.

Характеристики:

- non-transferable або transferable лише в систему;
- впливають на:
  - рівень доступу,
  - ліміти,
  - пріоритети у флоу (TJM/ABC).

### 4.7. Escrow / Conditional Token

**Призначення:** права, які активуються **лише після тригера**:

- підтвердження сервісу;
- успішний KYC/KYB;
- валідна геолокація/чекін;
- зовнішній оракул події.

Характеристики:

- стан `escrow_pending`, `escrow_released`, `escrow_cancelled`;
- вендор бачить `reserved entitlement`, але не може погасити до виконання умов.

### 4.8. Reservation / Hold Token

**Призначення:** бронювання ресурсу без остаточного споживання.

Приклади:

- бронювання столика/номера до часу X;
- hold-слот для медичного сервісу.

Характеристики:

- короткий TTL;
- чітка політика no-show / cancellation.

### 4.9. Index / Basket Token

**Призначення:** агрегований доступ до **кластеру** сервісів:

- «будь-яка кавʼярня в зоні A»;
- «будь-який готель з пулу партнерів категорії 4★».

Характеристики:

- під капотом — множина entitlements із певними вагами/правилами;
- потрібна:
  - прозора модель розрахунків з вендорами;
  - guardrails проти арбітражу.

### 4.10. Governance / Admin Token (обмежено)

**Призначення:** права участі в управлінні / конфігурації (DAO/операційні права).

Характеристики:

- мають жорсткі комплаєнс-вимоги;
- у Trutta **відокремлені** від споживчих entitlements;
- деталі — в окремих governance-документах (AS3/DAO-рівень, не тут).

---

## 5. Generic token lifecycle

### 5.1. States

Базовий набір станів (не всі використовуються кожним типом):

- `draft` — ще не доступний для реальних транзакцій;
- `issuable` — тип дозволений до емісії;
- `issued` — токен створено, але ще не привʼязано до конкретного аватара/групи;
- `allocated` — токен привʼязаний до avatar/group/account;
- `activated` — пройшов перший тригер (наприклад, початок validity-періоду або чекін);
- `escrow_pending` — чекає на умову (для escrow);
- `escrow_released` / `escrow_cancelled`;
- `claimed` — юзер заявив право (наприклад, показав QR/код);
- `redeemed` — сервіс фактично наданий;
- `expired` — вийшов за межі constraint-ів часу/geo;
- `cancelled` — скасовано до використання;
- `refunded` — повернуто вартість (із окремою подією settlement).

### 5.2. Transitions (узагальнено)

Типовий happy-path для base entitlement:

`issuable → issued → allocated → claimed → redeemed`

Для pass:

`issuable → issued → allocated → activated → redeemed/expired`

Для escrow:

`issuable → issued → allocated → escrow_pending → escrow_released → claimed → redeemed`

Для reservation:

`issuable → issued → allocated → activated → redeemed | expired | cancelled`

Усі переходи:

- ініціюються:
  - юзером (через app/бота),
  - вендором (frontdesk),
  - системою (cron/expiry, оракул);
- логяться як події для аналітики (VG-9xx).

---

## 6. Integration with DSL

### 6.1. `*.token.yaml`

Кожен `TokenType` у DSL:

- обирає **один головний archetype** (`base`, `bundle`, `pass`, `escrow`, тощо);
- вказує:
  - які стани дозволені;
  - які переходи (події/актор → `from_state → to_state`);
  - які constraints застосовуються.

### 6.2. Взаємозвʼязки

- `Offer` → указує, які `TokenType` створюються при покупці;
- `Product` → задає доменний контекст (Hotel/Dish/ServicePoint);
- `JourneyBinding` → вказує, на яких кроках TJM токен доступний/споживається;
- `Constraints` → підкладає time/geo/health/regulatory умови.

Token runtime повинен:

- відображати кожну зміну стану в аналітичних подіях;
- забезпечувати, щоб жоден перехід не порушував constraints.

---

## 7. Fraud & abuse considerations (на рівні дизайну)

Не технічні деталі, а **обовʼязкові сигнали для інженерії/аналітики**.

### 7.1. Обмеження швидкості та обсягу

- норми на:
  - кількість токенів певного класу на avatar/групу в період;
  - суми по локаціях/вендорах;
- ліміти для групових токенів, щоб уникати «висмоктування» субсидованих сервісів.

### 7.2. Anti-farming

- база entitlements (кава, базові meals) не повинні дозволяти:
  - нескінченний resale з націнкою;
  - накопичення в абсурдних обсягах для одного avatar.

Рішення: частина токенів за дизайном **must-be-consumed** (людиною) або мають жорсткі ліміти.

### 7.3. Гео та поведінкові патерни

- підозрілі патерни:
  - тисячі токенів, погашених на одній точці коротким burst-ом;
  - велика дистанція між avatar-гео і точкою редемпшену без логічного TJM-контексту.

DSL має дозволяти позначати токени як:

- `fraud_sensitive: true`;
- з додатковими вимогами до моніторингу.

---

## 8. Governance & upgrades

### 8.1. Створення нових archetypes

Новий тип токена можливий лише якщо:

- неможливо адекватно описати його на базі існуючих archetypes + constraints;
- є окремий CONCEPT-* документ;
- є оцінка:
  - регуляторних ризиків,
  - fraud surface,
  - UX-наслідків.

### 8.2. Зміни lifecycle

- будь-яка зміна стейтів/переходів для **існуючого TokenType**:
  - описується в окремому PD/VG-документі;
  - має міграційний план для вже випущених токенів;
  - не порушує прав уже виданих entitlements.

---

## 9. Relations to other docs

- PD-001  
  DSL як каркас; токени — один з основних артефактів.
- PD-002  
  формалізує терміни (Token, TokenType, Entitlement, Escrow Token, Soulbound).
- PD-003  
  фіксує формат `*.token.yaml` і звʼязки з іншими DSL-файлами.
- PD-004  
  описує, у яких data-layers живуть факти про використання токенів.
- CONCEPT-*  
  деталізують специфічні сценарії (Sospeso, city-pass, kidney-friendly travel).
- VG-8xx / VG-9xx  
  дають реалізаційні деталі runtime й аналітики.

PD-005 — це **референсна рамка**: будь-який новий токен у Trutta має бути зрозумілий як конкретний випадок одного або комбінації описаних archetypes. Якщо це неможливо — спочатку оновлюється PD-005, потім — DSL/імплементація.
